% Generic Package Imports
\usepackage[a4paper]{geometry}
\usepackage[english]{babel}
\usepackage[utf8]{inputenc}
\usepackage{subfiles}



% Standard Math tools
\usepackage{amssymb, mathtools, enumitem} 

% Better / easier to remember list environments
\newenvironment{romlist}{\begin{enumerate}[label={(\roman*)}]}{\end{enumerate}}
\newenvironment{numlist}{\begin{enumerate}[label={(\arabic*)}]}{\end{enumerate}}
\newenvironment{abclist}{\begin{enumerate}[label={(\alph*)}]}{\end{enumerate}}
\newenvironment{ROMlist}{\begin{enumerate}[label={(\Roman*)}]}{\end{enumerate}}
\newenvironment{ABClist}{\begin{enumerate}[label={(\Alph*)}]}{\end{enumerate}}

% Fancy Fonts
% Regular useful fonts
\usepackage{mathrsfs}
\usepackage[T1]{fontenc}
\usepackage{libertine}
\usepackage{libertinust1math}

% Line and paragraph spacing
\renewcommand{\baselinestretch}{1.08}

% Format chapter, section, and subsection headings better
\usepackage[sf]{titlesec}
\titleformat{\section}{\hspace*{-2.9em}\normalfont\large\sffamily\bfseries}{\thesection}{1em}{}
\titleformat{\subsection}{\normalfont\sffamily\bfseries}{\thesubsection}{1em}{} % ChkTeX 6
\titleformat{\chapter}[display]
 {\sffamily\bfseries\Large\vspace{5cm}\filleft}
 {\MakeUppercase{\chaptername}\enspace\thechapter}
 {2ex}
 {\titlerule[1pt]\vspace{2ex}\MakeUppercase}%
\titlespacing*{\chapter}{0pt}{-60pt}{10ex}
\titleformat{\part}[display]
  {\sffamily\bfseries\LARGE\vspace{5cm}\filleft}
  {\MakeUppercase{\partname}\enspace\thepart}
  {2ex}
  {\titlerule[2pt]\vspace{2ex}\MakeUppercase}

\newcommand{\Chapter}[1]{\chapter{#1}\label{Chapter: #1}}
\newcommand{\Section}[1]{\section{#1}\label{Section: #1}}
\newcommand{\Subsection}[1]{\subsection*{#1}\label{Subsection: #1}}

% Format table of contents better
\usepackage{titletoc}
\setcounter{tocdepth}{1}

% Bibliography setup (with BibLaTeX + Biber)
\usepackage{hyperref}
\hypersetup{
    linktoc=all,
    colorlinks=true,
    linkcolor=black, 
    anchorcolor=black, 
    citecolor=black,
    urlcolor=blue!65!black}
\usepackage[nameinlink]{cleveref}
\usepackage[style=numeric]{biblatex}

% Number equations within the section
\numberwithin{equation}{section}

% Graphics Packages and shortcuts
\usepackage{graphicx}
\usepackage{import}
\usepackage{xifthen}
\usepackage{pdfpages}
\usepackage{transparent}
\newcommand*{\resetfigpath}[1]{
    \graphicspath{{chapters/#1/figures/}}
}
\newcommand{\incfig}[2]{\def\svgwidth{\columnwidth}\import{#1}{#2.pdf_tex}}
\newcommand{\incpic}[1]{\includegraphics[width=0.8\columnwidth]{#1}}

% Make sure figures actually look nice
\renewcommand{\thefigure}{\arabic{chapter}.\arabic{section}.\arabic{equation}}
\newenvironment{Figure}%
  {\begin{figure}[ht]
    \addtocounter{equation}{1}
    \centering}
  {\end{figure}}

% Break-plain theorem environments
\usepackage[amsmath, thmmarks, hyperref, amsthm, thref]{ntheorem}
\usepackage{thmtools}
\usepackage[framemethod=tikz]{mdframed}

\theoremstyle{break}
\theoremindent=0.3cm
\theoremheaderfont{\kern-0.3cm\smallskip\normalfont\bfseries}

\newtheorem{sectheorem}{~}
\crefname{sectheorem}{theorem}{theorems}
\Crefname{sectheorem}{Theorem}{Theorems}
\renewtheorem*{sectheorem*}{~}
\newenvironment{Theorem}[1]%
  {\section[#1]{THEOREM:\@ #1}\begin{sectheorem*}\label{Theorem: #1}\vspace*{-1em}}%
  {\end{sectheorem*}}

\newtheorem{seclemma}{~}
\renewtheorem*{seclemma*}{~}
\newenvironment{Lemma}[1]%
  {\section[#1]{LEMMA:\@ #1}\label{Lemma: #1}\begin{seclemma*}\vspace*{-1em}}%
  {\end{seclemma*}}

\newtheorem{secitalic}{~}
\renewtheorem*{secitalic*}{~}
\newenvironment{SecItalic}[1]%
  {\section{#1}\label{Section: #1}\begin{secitalic*}\vspace*{-1em}}%
  {\end{secitalic*}}
\newenvironment{SecItalics}[1]{\begin{SecItalic}{#1}}{\end{SecItalic}}

\newtheorem{lemma}[equation]{Lemma}
\newtheorem{corollary}[equation]{Corollary}
\newtheorem{proposition}[equation]{Proposition}

\theorembodyfont{\normalfont\upshape}
\newtheorem{secdefinition}{~}
\renewtheorem*{secdefinition*}{~}
\newenvironment{Definition}[1]{\section[#1]{DEFINITION:\@ #1}\begin{secdefinition*}\vspace*{-1em}}{\end{secdefinition*}}

\newtheorem{secexample}{~}
\renewtheorem*{secexample*}{~}
\newenvironment{Example}[1]{\section[#1]{EXAMPLE:\@ #1}\begin{secexample*}\vspace*{-1em}}{\end{secexample*}}

\newtheorem{secproof}{~}
\renewtheorem*{secproof}{~}
\newenvironment{Proof}[1]{\section[#1]{PROOF: #1}\begin{secproof*}}{\begin{flushright}$\blacksquare$\end{flushright}\end{secproof*}}

\newtheorem{definition}[equation]{Definition}
\newtheorem{example}[equation]{Example}
\newtheorem{algorithm}[equation]{Algorithm}

\theoremheaderfont{\hspace*{-1em}\smallskip\normalfont\bfseries\sffamily}
\newtheorem{remark}[equation]{Remark}

% Theorem environemnts for banishing portions of text to end notes
\newtheorem{olddef}{Definition}
\renewtheorem*{olddef}{Definition}
\newtheorem{oldthm}{Theorem}
\renewtheorem*{oldthm}{Theorem}

% Hidable outline environment for proofs. 
\usepackage{environ}

\newif\ifshowoutlines
\showoutlinesfalse
\NewEnviron{outline}[1][Outline of the proof]{
  \ifshowoutlines%
  \subsection*{#1}%
  \begin{itemize}%
    \BODY%
  \end{itemize}%
  \begin{flushright}$\blacksquare$\end{flushright}%
  \fi 
}

% TODO: Figure out how to override default proof environment nicely
\newif\ifshowproofs
\showproofsfalse
\NewEnviron{prf}[1][\proofname]{
  \ifshowproofs%
  \subsection*{#1}%
  \BODY%
  \begin{flushright}$\blacksquare$\end{flushright}%
  \fi 
}

\newif\ifshowhints
\showhintsfalse
\NewEnviron{hints}{
  \ifshowhints%
  \begin{itemize}[label={\it Hint}]%
    \BODY%
  \end{itemize}%
  \fi%
}

\newif\ifshowexercises
\showexercisesfalse
\NewEnviron{exercise}[1]{
  \ifshowexercises%
  \subsection*{Exercise #1}%
  \BODY%
  \fi% 
}

\newif\ifshowsolutions
\showsolutionsfalse
\NewEnviron{solution}[1][Solution]{
  \ifshowsolutions%
  \subsection*{#1}%
  \BODY%
  \begin{flushright}$\blacksquare$\end{flushright}%
  \fi%
}

% Exercise sheet titles
\newcommand{\ExSheet}[1]{\chapter*{Exercise Sheet #1}\addcontentsline{toc}{chapter}{Exercise Sheet #1}}

% Endnotes
\usepackage{enotez}
\setenotez{
  list-heading={\section{#1}},
  list-name={Further Remarks},
  backref=true,
}
